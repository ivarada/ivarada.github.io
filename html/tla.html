<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSV Data Table</title>
  <style>
    body { font-family: sans-serif; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px 12px; border: 1px solid #ccc; text-align: left; }
    thead { background-color: #f2f2f2; }
  </style>
</head>
<body>

  <h2>My Sortable & Downloadable List</h2>
  
  <table id="my-table">
    <thead></thead>
    <tbody></tbody>
  </table>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  
  <script>
    // 2. Define the URL to your CSV file
    const csvUrl = 'https://ivarada.github.io/html/tla.csv';

    // 3. Use Papa Parse to fetch and parse the CSV
    Papa.parse(csvUrl, {
      download: true,   // Tells Papa Parse to fetch the file from the URL
      header: true,     // Assumes the first row of the CSV is the header
      complete: function(results) {
        // This function runs when parsing is complete
        console.log("Parsed Data:", results.data); // For debugging
        buildTable(results.data);
      },
      error: function(err) {
        // This function runs if there's an error fetching or parsing
        console.error("Error parsing CSV:", err);
        document.querySelector("tbody").innerHTML = `<tr><td colspan="100%">Error loading data. Please check the console.</td></tr>`;
      }
    });

    // 4. This function builds the HTML table from the data
    function buildTable(data) {
      const tableHead = document.querySelector("#my-table thead");
      const tableBody = document.querySelector("#my-table tbody");
      
      if (data.length > 0) {
        // Create the table header
        const headers = Object.keys(data[0]);
        let headerHTML = "<tr>";
        for (const header of headers) {
          headerHTML += `<th>${header}</th>`;
        }
        headerHTML += "</tr>";
        tableHead.innerHTML = headerHTML;

        // Create the table body rows
        let bodyHTML = "";
        for (const row of data) {
          // Skips any empty rows Papa Parse might find at the end of the file
          if (Object.values(row).every(val => val === "")) continue;

          bodyHTML += "<tr>";
          for (const header of headers) {
            bodyHTML += `<td>${row[header]}</td>`;
          }
          bodyHTML += "</tr>";
        }
        tableBody.innerHTML = bodyHTML;
      }
    }
  </script>

</body>
</html>
